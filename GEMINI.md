# Flair-Project

Flairは、フローチャートを簡単作成できるビジュアルプログラミング環境です。PythonアプリケーションとしてGUI、フレーム・ブロック管理、JSON保存・読込機能を搭載。

## 機能

### インターフェース
-モダンなダークテーマのGUI
- 3つの主要セクション：
    -メニューバー（左端）
    -サイドバー（左側）
    -メインバー（右側）

### 主要機能
1.  **フレーム・ブロック管理**
    - フレームの追加と管理
    - ブロック内でのテキスト編集

2.  **ファイル操作**
    - JSON形式（.json）でのデータの保存と読み込み

3.  **ユーザーインターフェース**
    - マウスホイールによるスクロール
    - フレーム・ブロックの選択状態の視覚的フィードバック

## はじめに

1.  **プログラムの実行**
    - Windowsの場合: `.\run.bat`
    - macOS/Linuxの場合: `./run.sh`
    - メインだけで実行 (すべてのOS): `python maincode/Flair.py`

## 使用方法

1.  **メニューバーの操作**
    - **ファイルアイコン**: ファイル操作メニューを表示します。
    - **ブロックアイコン**: ブロック操作メニューを表示します。

2.  **フレーム・ブロックの作成**
    - **フレーム追加**: 「frame」ボタンをクリックします。
    - **ブロック追加**: 「block」ボタンをクリックします。
    - フレーム内でブロックを選択して編集します。

3.  **ファイルの保存と読み込み**
    - **JSONファイルに保存**: 「Save File」
    - **JSONファイルから読み込み**: 「Open File」

## プロジェクト構造
```
Flair-Project/
├── .editorconfig
├── commit.bat
├── desktop.ini
├── GEMINI.md
├── README.md
├── run.bat
├── run.sh
├── .git/...
├── .venv/...
├── .venv_old/...
├── .vscode/...
├── CodeSmith_ai_agent/
│   ├── .gitignore
│   ├── Dockerfile
│   ├── pyproject.toml
│   ├── README.md
│   ├── app/
│   │   ├── __init__.py
│   │   └── server.py
│   └── packages/
│       └── README.md
├── docs/...
├── image/
│   └── menubar/
│       ├── block_icon.png
│       └── file_icon.png
├── maincode/
│   └── Flair.py
└── test_json/
    ├── aaa.json
    └── test.json
```

## 個別ルール
- geminiが起動されたらまず[/chat resume main]でチャットの内容をロードすることをユーザーにおすすめしてください。
- この内容やプロジェクト構成・各種仕様が変更された場合は、必ずGEMINI.mdを最新化すること
- 自動更新時は必ずレビュー（内容チェック）を実施し、手動でも修正可能
- ユーザーがこのチャットを終わるというような内容を言ったら必ずGEMINI.mdを最新化にして自動更新時は必ずレビュー（内容チェック）を実施し、手動でも修正可能にして。また、gitで[git status]でgitの状態が正常であるか確認します。そのあとユーザーがいるブランチに[git add .]と書いて。さらに「commit -m ""」という形式で""の中にコメットメッセージを考えて実行してください。また、もしコードに節目が出来たらユーザーにpushの提案をしてください。もしユーザーがpushの提案に許可を出したらこのコマンドを打ってください。[git push origin "現在のユーザーのブランチ"]。そのあユーザーに[/chat save main]と打ってもらってこのチャットの内容をセーブすることをおすすめしてください。


---

## 変更履歴

### 2025年12月17日
- **フレーム横幅の調節機能の改善**:
    - フレームの右端をドラッグして横幅を調節する機能を追加。
    - `QMouseEvent.pos()`の非推奨警告を解消するため、`event.position().toPoint()`を使用するように修正。
    - フレームの左端をドラッグして、前のフレームの幅を調節する機能を追加。この際、移動量が過大になる問題を修正。
    - フレーム間の境界線をドラッグした際に、両隣のフレームが同時にリサイズされる「スプリッター」動作を実装。
    - リサイズ中に最小幅の制限をなくし、幅が0より大きいことを保証する修正を実施。
    - `AttributeError: 'QtFrame' object has no attribute 'original_width'`を修正。
    - リサイズ機能が動作しなくなった問題を解決するため、`mousePressEvent`で常に`super().mousePressEvent(event)`を呼び出すように修正。
- **グローバル`frames`リストの廃止**: `FlairApp`クラスがグローバルな`frames`リストに依存しないよう、`self.frames`インスタンス変数を使用するようにリファクタリング。

### 2025年12月9日
- **PySide6インポートエラーの解決**
    - 既存の仮想環境を削除し、`run.sh`スクリプトを再実行することで、`PySide6`および関連する依存関係が正しくインストールされるようにしました。これにより、`maincode/Flair.py`でのインポートエラーが解消されました。
- **`QMouseEvent.globalPos()`非推奨警告の修正 (`maincode/Flair.py`)**:
    - `QMouseEvent.globalPos()`の使用箇所を、推奨される`QMouseEvent.globalPosition().toPoint()`に置き換え、非推奨警告を解消しました。

### 2025年12月6日
- **WSL2環境における起動時間の改善とレイアウトの調整**:
    - `run.sh`スクリプトを、WSL2のLinux環境でLinuxネイティブのPython仮想環境を使用するように変更。これにより、アプリケーションの起動時間を約3秒から約0.2秒に短縮。
    - アプリケーション起動時に、現在のQtスタイルと利用可能なスタイルを出力するデバッグコードを一時的に追加し、Qtのスタイル設定を`Fusion`から`Windows`に一時的に変更してGUIの見た目の差異を調査。
    - デバッグコードとスタイル設定は作業完了後に元の状態に戻した。
    - ユーザーの要望により、一時的に起動時間を以前の3秒の状態に戻す試みを実施。その結果、`run.sh`がWindowsのPython環境を必要とすることが原因でエラーが発生することを確認。
    - 再度ユーザーの要望により、WSL2のLinux環境で高速起動する状態に`run.sh`を修正し、`Linux`ネイティブの仮想環境を再構築した。


### 2025年10月7日
- **フレーム選択ロジックの改善 (`maincode/Flair.py`)**:
    - `mousePressEvent`の処理を全面的に見直し、クリックされたウィジェットの親を辿って`QtFrame`を特定する方式に変更。
    - これにより、フレーム自身やその中の要素をクリックした際に、正しくフレームが選択されるようになった。
    - フレーム外の領域をクリックした際に、すべてのフレームの選択を解除する機能 (`deselect_all_frames`) を実装。
    - `QtFrame`から不要になった`clicked`シグナルと関連コードを削除し、リファクタリングを実施。


### 2025年10月6日
- **フレーム選択機能の実装 (`maincode/Flair.py`)**:
    - フレーム (`QtFrame`) をクリックすることで、そのフレームを選択状態（青い枠線でハイライト）にできるように変更。
    - フレーム以外の領域をクリックすると、選択が解除されるように実装。
- **汎用クリックイベント処理の検討 (`maincode/Flair.py`)**:
    - `mousePressEvent` を、任意のウィジェット(`search_widget`)範囲外のクリックを検知する汎用的な実装に変更する試みが行われた。
    - この実装は、呼び出し先の `select_search_widget` メソッドが未定義であるため、現状では不完全な状態。

### 2025年10月5日
- **`run.bat`の改善:**
    - `pause`コマンドを削除し、実行後に待機しないように変更。
    - `start /b`を使用し、アプリケーションがバックグラウンドで実行されるように修正。これにより、コマンドプロンプトをブロックせずにアプリを起動できるようになった。
- **UIの改善 (`maincode/Flair.py`)**:
    - サイドバーのボタンにスタイルを適用し、視覚的に分かりやすいデザインに変更。
    - スタイルの競合問題を解決し、色が正しく表示されるように修正。
    - ボタンの背景色を変数 (`self.sidebar_button_color`) で管理するようにリファクタリングし、メンテナンス性を向上。